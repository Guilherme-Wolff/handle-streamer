import fetch from"node-fetch";import{readFileSync}from"fs";import{config}from"../config/index.js";let ID="Eh1C3JiB";export class Pixeldrain{API_KEY;BASE_API="https://pixeldrain.com/api";constructor(i=process.env.PIXELDRAIN_API_KEY||config.BUCKET_FILES.PIXELDRAIN_API_KEY){i&&(this.API_KEY=i,this.updateKey().then((i=>i)))}async updateKey(){const i=await fetch(`${this.BASE_API}/user/session`,{headers:{Cookie:`pd_auth_key=${this.API_KEY}`}}),e=await i.json();return config.BUCKET_FILES.PIXELDRAIN_API_KEY=e[0].auth_key,this.API_KEY=e[0].auth_key,await e[0].auth_key}geteKey(){return this.API_KEY}async createAlbum(i){const e=`${this.BASE_API}/list`,t={"Content-Type":"application/json","Referrer-Policy":"strict-origin-when-cross-origin",Cookie:`pd_auth_key=${this.API_KEY}`};try{const o=await fetch(e,{method:"POST",headers:t,body:JSON.stringify(i)});if(o.ok){return(await o.json()).id}return}catch(i){}}async getFilesList(i){const e={Origin:"pixeldrain.com","Referrer-Policy":"strict-origin-when-cr,oss-origin","Accept-Encoding":"gzip, deflate, br","Content-Type":"application / json",Cookie:`pd_auth_key=${this.API_KEY}`,"User-Agent":"Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Mobile Safari/537.36"},t=await fetch(`${this.BASE_API}/list/${i}`,{method:"GET",headers:e});if(t.ok){const i=await t.json(),e=(await i.files).map((i=>i.id)).map((i=>({id:i,description:""})));return await e}}async upload(i,e){const t=readFileSync(i);try{const i={Origin:"pixeldrain.com",Referer:"https://pixeldrain.com/",Cookie:`pd_auth_key=${this.API_KEY}`,"User-Agent":"Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Mobile Safari/537.36"},o=await fetch(`https://pixeldrain.com/api/file/${e}`,{method:"PUT",headers:i,body:t});if(o){const i=await o.json();return await i.id}}catch(i){}}async addFileInAlbum(i,e,t){const o=await this.getFilesList(e);await o.push({id:i,description:""});const a=`https://pixeldrain.com/api/list/${e}`,n={title:t,anonymous:!1,files:o},r={"Referrer-Policy":"strict-origin-when-cross-origin","Content-Type":"application/json",Cookie:`pd_auth_key=${this.API_KEY}`,"User-Agent":"Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Mobile Safari/537.36"};try{const i=await fetch(a,{method:"PUT",headers:r,body:JSON.stringify(n)});if(i.ok){await i.json();return}return}catch(i){}}}